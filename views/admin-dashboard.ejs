<%- include('partials/head', { title }) %>
<%- include('partials/navbar') %>

<main class="min-h-screen bg-slate-50 pb-20">
  <%
    const totalUsers = Array.isArray(users) ? users.length : 0;
    const adminCount = Array.isArray(users) ? users.filter((item) => item.role === 'admin').length : 0;
    const staffCount = Array.isArray(users) ? users.filter((item) => item.role === 'staff').length : 0;
    const pendingUsers = Array.isArray(users) ? users.filter((item) => !item.isApproved) : [];
    const approvalRate = totalUsers ? Math.round(((totalUsers - pendingUsers.length) / totalUsers) * 100) : 0;
    const recentUsers = Array.isArray(users) ? users.slice(0, 5) : [];

    const overviewStats = [
      {
        label: 'สมาชิกทั้งหมด',
        value: totalUsers.toLocaleString('th-TH'),
        hint: `ยืนยันแล้ว ${approvalRate}% ของทั้งหมด`,
        iconPath: 'M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z'
      },
      {
        label: 'ผู้ดูแลระบบ',
        value: adminCount.toLocaleString('th-TH'),
        hint: 'สิทธิ์เต็มสำหรับจัดการระบบ',
        iconPath: 'M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.623 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285z'
      },
      {
        label: 'เจ้าหน้าที่',
        value: staffCount.toLocaleString('th-TH'),
        hint: 'ทีมงานที่ช่วยดูแลงานประจำ',
        iconPath: 'M18 18.72a9.094 9.094 0 003.741-.479 3 3 0 00-4.682-2.72m.94 3.198l.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0112 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 016 18.719m12 0a5.971 5.971 0 00-.941-3.197m0 0A5.995 5.995 0 0012 12.75a5.995 5.995 0 00-5.058 2.772m0 0a3 3 0 00-4.681 2.72 8.986 8.986 0 003.74.477m.94-3.197a5.971 5.971 0 00-.94 3.197M15 6.75a3 3 0 11-6 0 3 3 0 016 0zm6 3a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0zM7.5 3a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0z'
      },
      {
        label: 'รอการอนุมัติ',
        value: pendingUsers.length.toLocaleString('th-TH'),
        hint: pendingUsers.length ? `เหลืออีก ${pendingUsers.length} รายการที่ต้องตรวจสอบ` : 'อนุมัติครบทุกคนแล้ว',
        iconPath: 'M12 8v4h3m6 0a9 9 0 11-18 0 9 9 0 0118 0z'
      }
    ];

    const quickActions = [
      {
        label: 'ภาพสไลด์',
        description: 'อัปเดตสไลด์หน้าแรก',
        href: '/admin/slider',
        accent: 'bg-blue-100 text-blue-600',
        iconPath: 'M4 6h16M4 12h16M4 18h16'
      },
      {
        label: 'ข่าวสาร',
        description: 'จัดการประกาศและข่าว',
        href: '/admin/news',
        accent: 'bg-green-100 text-green-600',
        iconPath: 'M4 7h16M4 12h16m-7 5h7'
      },
      {
        label: 'หมวดเมนู',
        description: 'ปรับโครงสร้างบริการ',
        href: '/admin/menu-categories',
        accent: 'bg-purple-100 text-purple-600',
        iconPath: 'M4 6h16M4 12h16M4 18h16'
      },
      {
        label: 'เมนูย่อ',
        description: 'ดูแลเมนูลัดที่ใช้บ่อย',
        href: '/admin/menu-items',
        accent: 'bg-orange-100 text-orange-600',
        iconPath: 'M12 4v16m8-8H4'
      },
      {
        label: 'หมวดข่าว',
        description: 'จัดหมวดหมู่สำหรับข่าว',
        href: '/admin/news-categories',
        accent: 'bg-pink-100 text-pink-600',
        iconPath: 'M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z'
      },
      {
        label: 'สมาชิก',
        description: 'ดูแลสิทธิ์และสถานะ',
        href: '/admin/users',
        accent: 'bg-indigo-100 text-indigo-600',
        iconPath: 'M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z'
      }
    ];
  %>

  <section class="relative isolate overflow-hidden bg-gradient-to-br from-primary-600 via-primary-500 to-primary-400">
    <div class="pointer-events-none absolute left-1/2 top-[-160px] h-72 w-72 -translate-x-1/2 rounded-full bg-white/20 blur-3xl"></div>
    <div class="pointer-events-none absolute bottom-[-140px] right-[-100px] h-72 w-72 rounded-full bg-white/10 blur-3xl"></div>
    <div class="relative mx-auto max-w-7xl px-4 py-14 sm:px-6 lg:px-8">
      <header class="relative overflow-hidden rounded-4xl border border-white/30 bg-white/95 p-10 shadow-2xl backdrop-blur-sm ring-1 ring-black/5">
        <div class="pointer-events-none absolute -left-24 top-16 h-32 w-32 rounded-full bg-primary-100/60 blur-2xl"></div>
        <div class="pointer-events-none absolute -right-24 -top-28 h-40 w-40 rounded-full bg-emerald-100/50 blur-2xl"></div>
        <div class="relative grid gap-10 lg:grid-cols-[1.2fr_.8fr] lg:items-start">
          <div class="space-y-6">
            <span class="inline-flex items-center gap-2 rounded-full bg-primary-100/80 px-4 py-1 text-sm font-semibold text-primary-700 shadow-sm">
              แผงควบคุมผู้ดูแล
            </span>
            <div class="space-y-3">
              <h1 class="text-4xl font-extrabold text-slate-900 sm:text-5xl">สรุปภาพรวมระบบในวันนี้</h1>
              <p class="text-base leading-relaxed text-slate-600">
                สวัสดี <%= currentUser ? currentUser.name : 'ผู้ดูแลระบบ' %> ดำเนินงานหลักทั้งหมดได้ในแดชบอร์ดเดียว ตั้งแต่ติดตามสมาชิก อนุมัติคำขอ ไปจนถึงดูแลเนื้อหาหน้าเว็บ
              </p>
            </div>
            <div class="flex flex-wrap items-center gap-3">
              <a
                href="/register"
                class="inline-flex items-center gap-2 rounded-full bg-primary-600 px-5 py-2.5 text-sm font-semibold text-white shadow-lg transition hover:-translate-y-0.5 hover:bg-primary-700"
              >
                <svg class="h-4 w-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 5v14m7-7H5" />
                </svg>
                เพิ่มสมาชิกใหม่
              </a>
              <a
                href="/admin/users"
                class="inline-flex items-center gap-2 rounded-full border border-slate-200 bg-white px-5 py-2.5 text-sm font-semibold text-slate-600 transition hover:border-primary-200 hover:text-primary-700"
              >
                <svg class="h-4 w-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
                </svg>
                จัดการสมาชิกทั้งหมด
              </a>
            </div>
          </div>

          <div class="grid gap-4 sm:grid-cols-2">
            <% overviewStats.forEach((stat) => { %>
              <div class="rounded-3xl border border-slate-100 bg-white/90 p-6 shadow-sm transition hover:-translate-y-1 hover:border-primary-200 hover:shadow-lg">
                <div class="flex items-start justify-between gap-4">
                  <span class="flex h-12 w-12 items-center justify-center rounded-2xl bg-primary-50 text-primary-600">
                    <svg class="h-6 w-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" d="<%= stat.iconPath %>" />
                    </svg>
                  </span>
                </div>
                <div class="mt-6 space-y-1">
                  <p class="text-3xl font-bold text-slate-900"><%= stat.value %></p>
                  <p class="text-sm font-semibold text-slate-700"><%= stat.label %></p>
                  <p class="text-xs text-slate-500"><%= stat.hint %></p>
                </div>
              </div>
            <% }) %>
          </div>
        </div>

        <div class="mt-12">
          <div class="flex items-center justify-between gap-3">
            <h2 class="text-sm font-semibold uppercase tracking-widest text-slate-500">เมนูลัดที่ใช้งานบ่อย</h2>
            <span class="text-xs text-slate-400">เข้าถึงงานสำคัญในคลิกเดียว</span>
          </div>
          <div class="mt-5 grid gap-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6">
            <% quickActions.forEach((action) => { %>
              <a
                href="<%= action.href %>"
                class="group flex items-center gap-3 rounded-2xl border border-slate-100 bg-white/80 p-4 shadow-sm transition hover:-translate-y-1 hover:border-primary-200 hover:shadow-lg"
              >
                <span class="flex h-11 w-11 items-center justify-center rounded-xl <%= action.accent %>">
                  <svg class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="<%= action.iconPath %>" />
                  </svg>
                </span>
                <div>
                  <p class="text-sm font-semibold text-slate-800"><%= action.label %></p>
                  <p class="text-xs text-slate-500"><%= action.description %></p>
                </div>
              </a>
            <% }) %>
          </div>
        </div>
      </header>
    </div>
  </section>

  <div class="-mt-12">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <%- include('partials/flash') %>

      <section class="mt-14 grid gap-8 lg:grid-cols-[minmax(0,3fr)_minmax(0,2fr)]">
        <div class="space-y-8">
          <div class="rounded-4xl border border-slate-200 bg-white/95 shadow-sm ring-1 ring-black/5">
            <div class="flex flex-wrap items-center justify-between gap-4 border-b border-slate-100 px-6 py-5">
              <div class="flex items-center gap-3">
                <span class="flex h-10 w-10 items-center justify-center rounded-xl bg-primary-100 text-primary-600">
                  <svg class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z" />
                  </svg>
                </span>
                <div>
                  <h2 class="text-lg font-semibold text-slate-900">รายชื่อสมาชิก</h2>
                  <p class="text-xs text-slate-500">
                    เรียงลำดับจากวันที่สร้างล่าสุด • รวมทั้งหมด <%= totalUsers %> รายการ
                  </p>
                </div>
              </div>
              <a
                href="/admin/users"
                class="inline-flex items-center gap-2 rounded-full border border-slate-200 bg-white px-4 py-2 text-xs font-semibold text-slate-600 transition hover:border-primary-200 hover:text-primary-700"
              >
                ดูทั้งหมด
                <svg class="h-3.5 w-3.5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
                </svg>
              </a>
            </div>

            <div class="overflow-hidden">
              <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-slate-200 text-sm">
                  <thead class="bg-slate-50/80 text-left text-xs font-semibold uppercase tracking-wider text-slate-500">
                    <tr>
                      <th scope="col" class="px-6 py-3">สมาชิก</th>
                      <th scope="col" class="px-6 py-3">ตำแหน่ง / สังกัด</th>
                      <th scope="col" class="px-6 py-3">ติดต่อ</th>
                      <th scope="col" class="px-6 py-3">สิทธิ์และสถานะ</th>
                      <th scope="col" class="px-6 py-3 text-center">การจัดการ</th>
                    </tr>
                  </thead>
                  <tbody class="divide-y divide-slate-100 bg-white">
                    <% if (users && users.length) { %>
                      <% users.forEach((user) => { %>
                        <tr class="transition hover:bg-primary-50/30 <%= user.isApproved ? '' : 'bg-amber-50/40' %>">
                          <td class="px-6 py-4 align-top">
                            <div class="flex items-start gap-3">
                              <span class="flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-full bg-primary-100 text-sm font-semibold text-primary-600">
                                <%= (user.name || '?').slice(0, 1).toUpperCase() %>
                              </span>
                              <div class="min-w-0">
                                <p class="text-sm font-semibold text-slate-800"><%= user.name %></p>
                                <p class="text-xs text-slate-500">
                                  สมัครเมื่อ <%= new Date(user.createdAt).toLocaleDateString('th-TH', { day: 'numeric', month: 'short', year: 'numeric' }) %>
                                </p>
                              </div>
                            </div>
                          </td>
                          <td class="px-6 py-4 align-top">
                            <p class="text-sm font-medium text-slate-700"><%= user.position || 'ไม่ระบุ' %></p>
                            <p class="text-xs text-slate-500"><%= user.affiliation || '---' %></p>
                          </td>
                          <td class="px-6 py-4 align-top">
                            <div class="space-y-1 text-xs text-slate-500">
                              <a href="mailto:<%= user.email %>" class="inline-flex items-center gap-1 text-primary-600 hover:underline">
                                <svg class="h-3.5 w-3.5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                  <path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8m-18 8h18a2 2 0 002-2V8a2 2 0 00-2-2H3a2 2 0 00-2 2v6a2 2 0 002 2z" />
                                </svg>
                                <%= user.email %>
                              </a>
                              <% if (user.phone) { %>
                                <div class="inline-flex items-center gap-1">
                                  <svg class="h-3.5 w-3.5 text-slate-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 5h2l2 5-2 1a11 11 0 005 5l1-2 5 2v2a2 2 0 01-2 2h-1a16 16 0 01-16-16V5a2 2 0 012-2z" />
                                  </svg>
                                  <%= user.phone %>
                                </div>
                              <% } %>
                            </div>
                          </td>
                          <td class="px-6 py-4 align-top">
                            <div class="space-y-2 text-xs">
                              <span class="inline-flex items-center gap-1 rounded-full bg-slate-100 px-3 py-1 font-semibold text-slate-600">
                                <svg class="h-3 w-3" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 6l7.5 4.5-7.5 4.5L4.5 10.5 12 6z" />
                                </svg>
                                <%= user.role === 'admin' ? 'ผู้ดูแลระบบ' : 'เจ้าหน้าที่' %>
                              </span>
                              <% if (user.isApproved) { %>
                                <span class="inline-flex items-center gap-1 rounded-full bg-emerald-100 px-3 py-1 font-semibold text-emerald-700">
                                  <svg class="h-3.5 w-3.5" fill="none" stroke="currentColor" stroke-width="1.6" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" />
                                  </svg>
                                  ยืนยันแล้ว
                                </span>
                              <% } else { %>
                                <span class="inline-flex items-center gap-1 rounded-full bg-amber-100 px-3 py-1 font-semibold text-amber-700">
                                  <svg class="h-3.5 w-3.5" fill="none" stroke="currentColor" stroke-width="1.6" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4h3m6 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                                  </svg>
                                  รออนุมัติ
                                </span>
                              <% } %>
                            </div>
                          </td>
                          <td class="px-6 py-4 align-top">
                            <div class="flex flex-col gap-2 text-xs sm:flex-row sm:items-center">
                              <form action="/admin/users/<%= user.id %>/approval" method="post">
                                <input type="hidden" name="action" value="<%= user.isApproved ? 'revoke' : 'approve' %>" />
                                <button
                                  type="submit"
                                  class="inline-flex w-full items-center justify-center gap-1 rounded-full px-3 py-1.5 font-semibold text-white shadow-sm transition <%= user.isApproved ? 'bg-amber-500/90 hover:bg-amber-600' : 'bg-emerald-500/90 hover:bg-emerald-600' %> <%= currentUser && currentUser.id === user.id ? 'cursor-not-allowed opacity-60' : '' %>"
                                  <%= currentUser && currentUser.id === user.id ? 'disabled' : '' %>
                                >
                                  <svg class="h-3.5 w-3.5 text-white/80" fill="none" stroke="currentColor" stroke-width="1.6" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" />
                                  </svg>
                                  <%= user.isApproved ? 'ยกเลิกยืนยัน' : 'อนุมัติบัญชี' %>
                                </button>
                              </form>
                              <form action="/admin/users/<%= user.id %>/role" method="post" class="flex items-center gap-2">
                                <select
                                  name="role"
                                  class="rounded-full border border-slate-200 px-3 py-1 font-medium text-slate-600 focus:border-primary-400 focus:outline-none focus:ring-2 focus:ring-primary-200 disabled:cursor-not-allowed disabled:bg-slate-100"
                                  <%= currentUser && currentUser.id === user.id ? 'disabled' : '' %>
                                >
                                  <option value="staff" <%= user.role === 'staff' ? 'selected' : '' %>>เจ้าหน้าที่</option>
                                  <option value="admin" <%= user.role === 'admin' ? 'selected' : '' %>>ผู้ดูแลระบบ</option>
                                </select>
                                <button
                                  type="submit"
                                  class="inline-flex items-center gap-1 rounded-full bg-primary-600 px-3 py-1.5 font-semibold text-white shadow-sm transition hover:bg-primary-700 disabled:cursor-not-allowed disabled:bg-slate-300"
                                  <%= currentUser && currentUser.id === user.id ? 'disabled' : '' %>
                                >
                                  <svg class="h-3.5 w-3.5 text-white/90" fill="none" stroke="currentColor" stroke-width="1.6" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M5 13a4 4 0 014-4h9m0 0-3-3m3 3-3 3" />
                                  </svg>
                                  บันทึก
                                </button>
                              </form>
                            </div>
                          </td>
                        </tr>
                      <% }) %>
                    <% } else { %>
                      <tr>
                        <td colspan="5" class="px-6 py-12 text-center text-slate-500">
                          ยังไม่มีข้อมูลสมาชิกในระบบ เริ่มต้นด้วยการเพิ่มสมาชิกใหม่ทันที
                        </td>
                      </tr>
                    <% } %>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <aside class="space-y-8">
          <div class="rounded-4xl border border-amber-200 bg-gradient-to-br from-amber-50 via-white to-amber-100 p-6 shadow-sm">
            <div class="flex items-start justify-between gap-3">
              <div class="flex items-center gap-3">
                <span class="flex h-10 w-10 items-center justify-center rounded-xl bg-amber-200 text-amber-700">
                  <svg class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4h3m6 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                </span>
                <div>
                  <h2 class="text-base font-semibold text-amber-900">คำขอรออนุมัติ</h2>
                  <p class="text-xs text-amber-700">จัดการคำขอใหม่เพื่อให้สมาชิกใช้งานได้เร็วขึ้น</p>
                </div>
              </div>
              <span class="inline-flex items-center justify-center rounded-full bg-amber-200 px-3 py-1 text-sm font-bold text-amber-800">
                <%= pendingUsers.length %>
              </span>
            </div>

            <% if (pendingUsers.length) { %>
              <div class="mt-6 space-y-3">
                <% pendingUsers.slice(0, 4).forEach((member) => { %>
                  <div class="rounded-2xl border border-amber-200 bg-white/85 p-4 shadow-sm">
                    <div class="flex items-start justify-between gap-3">
                      <div class="min-w-0">
                        <p class="text-sm font-semibold text-slate-900 truncate"><%= member.name %></p>
                        <p class="mt-1 text-xs text-slate-500 truncate"><%= member.email %></p>
                        <p class="mt-2 text-xs text-amber-600">
                          สมัครเมื่อ <%= new Date(member.createdAt).toLocaleDateString('th-TH', { day: 'numeric', month: 'short', year: 'numeric' }) %>
                        </p>
                      </div>
                      <form action="/admin/users/<%= member.id %>/approval" method="post">
                        <input type="hidden" name="action" value="approve" />
                        <button
                          type="submit"
                          class="inline-flex items-center gap-1 rounded-full bg-emerald-500 px-3 py-1.5 text-xs font-semibold text-white shadow-sm transition hover:bg-emerald-600"
                        >
                          <svg class="h-3 w-3" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" />
                          </svg>
                          อนุมัติ
                        </button>
                      </form>
                    </div>
                  </div>
                <% }) %>
              </div>
              <% if (pendingUsers.length > 4) { %>
                <div class="mt-4 text-center">
                  <a
                    href="/admin/users"
                    class="inline-flex items-center gap-2 rounded-full border border-amber-300 bg-white px-4 py-2 text-xs font-semibold text-amber-700 transition hover:bg-amber-50"
                  >
                    ดูทั้งหมด <%= pendingUsers.length %> รายการ
                    <svg class="h-3.5 w-3.5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
                    </svg>
                  </a>
                </div>
              <% } %>
            <% } else { %>
              <div class="mt-6 rounded-2xl border border-emerald-200 bg-emerald-50 p-6 text-center">
                <div class="mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-emerald-100 text-emerald-600">
                  <svg class="h-6 w-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" />
                  </svg>
                </div>
                <p class="mt-3 text-sm font-semibold text-emerald-700">อนุมัติครบทุกคำขอแล้ว</p>
                <p class="text-xs text-emerald-600">ไม่มีสมาชิกที่รอการยืนยัน</p>
              </div>
            <% } %>
          </div>

          <div class="rounded-4xl border border-slate-200 bg-white/95 p-6 shadow-sm">
            <div class="mb-4 flex items-center gap-3">
              <span class="flex h-10 w-10 items-center justify-center rounded-xl bg-slate-100 text-slate-600">
                <svg class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
              </span>
              <div>
                <h2 class="text-base font-semibold text-slate-900">สมาชิกใหม่ล่าสุด</h2>
                <p class="text-xs text-slate-500">จับตาการเติบโตของชุมชน</p>
              </div>
            </div>

            <% if (recentUsers.length) { %>
              <div class="space-y-3">
                <% recentUsers.slice(0, 5).forEach((member) => { %>
                  <div class="flex items-center gap-3 rounded-2xl border border-slate-100 bg-slate-50/70 p-3">
                    <span class="flex h-8 w-8 items-center justify-center rounded-full bg-primary-100 text-primary-600 text-sm font-semibold">
                      <%= (member.name || '?').slice(0, 1).toUpperCase() %>
                    </span>
                    <div class="min-w-0 flex-1">
                      <p class="text-sm font-semibold text-slate-800 truncate"><%= member.name %></p>
                      <p class="text-xs text-slate-500 truncate"><%= member.email %></p>
                    </div>
                    <span class="text-xs text-slate-400">
                      <%= new Date(member.createdAt).toLocaleDateString('th-TH', { day: 'numeric', month: 'short' }) %>
                    </span>
                  </div>
                <% }) %>
              </div>
            <% } else { %>
              <div class="rounded-2xl border border-slate-100 bg-slate-50 p-6 text-center text-sm text-slate-500">
                ยังไม่มีสมาชิกใหม่ในช่วงนี้
              </div>
            <% } %>
          </div>
        </aside>
      </section>
    </div>
  </div>
</main>

<%- include('partials/footer') %>
