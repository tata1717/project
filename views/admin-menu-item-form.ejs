<%- include('partials/head', { title }) %>
<%- include('partials/navbar') %>

<main class="mx-auto flex w-full max-w-4xl flex-1 flex-col gap-10 px-4 py-12 sm:px-6 lg:px-8">
  <header class="flex flex-col gap-6 rounded-3xl border border-primary-100 bg-white/80 p-6 shadow-sm backdrop-blur sm:flex-row sm:items-center sm:justify-between">
    <div class="space-y-2">
      <p class="text-xs font-semibold uppercase tracking-wider text-primary-500">จัดการเนื้อหา</p>
      <h1 class="text-3xl font-semibold text-primary-700"><%= title %></h1>
      <p class="max-w-xl text-sm leading-relaxed text-slate-600">
        <%= mode === 'create' ? 'เพิ่มเมนูย่อใหม่สำหรับแสดงในหน้าแรก' : 'แก้ไขข้อมูลเมนูย่อ' %>
      </p>
    </div>
    <div class="flex flex-wrap items-center gap-3">
      <a
        href="/admin/menu-items"
        class="inline-flex items-center gap-2 rounded-full border border-primary-200/80 px-5 py-2.5 text-sm font-semibold text-primary-600 transition hover:bg-primary-50"
      >
        <svg class="h-4 w-4 text-primary-500" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
        </svg>
        กลับไปรายการ
      </a>
    </div>
  </header>

  <%- include('partials/flash') %>

  <section class="rounded-3xl bg-white/90 shadow-sm ring-1 ring-black/5 backdrop-blur">
    <div class="px-6 py-4 border-b border-slate-100">
      <h2 class="text-lg font-semibold text-slate-800">ข้อมูลเมนูย่อ</h2>
      <p class="text-xs text-slate-500">กรอกข้อมูลเมนูย่อที่ต้องการ</p>
    </div>
    
    <form 
      action="<%= mode === 'create' ? '/admin/menu-items' : `/admin/menu-items/${item.id}` %>" 
      method="post" 
      enctype="multipart/form-data"
      class="p-6 space-y-6"
    >
      <div class="grid gap-6 md:grid-cols-2">
        <div class="space-y-2">
          <label for="title" class="block text-sm font-semibold text-slate-700">
            ชื่อเมนูย่อ <span class="text-red-500">*</span>
          </label>
          <input
            type="text"
            id="title"
            name="title"
            value="<%= item ? item.title : '' %>"
            class="w-full rounded-xl border border-slate-200 px-4 py-3 text-sm focus:border-primary-400 focus:outline-none focus:ring-2 focus:ring-primary-200"
            placeholder="เช่น ข้อมูลติดต่อ, ดาวน์โหลดเอกสาร"
            required
          />
          <p class="text-xs text-slate-500">ชื่อที่แสดงในหน้าแรก</p>
        </div>

        <div class="space-y-2">
          <label for="category_id" class="block text-sm font-semibold text-slate-700">
            หมวดเมนู <span class="text-red-500">*</span>
          </label>
          <select
            id="category_id"
            name="category_id"
            class="w-full rounded-xl border border-slate-200 px-4 py-3 text-sm focus:border-primary-400 focus:outline-none focus:ring-2 focus:ring-primary-200"
            required
          >
            <option value="">เลือกหมวดเมนู</option>
            <% categories.forEach((category) => { %>
              <option value="<%= category.id %>" <%= item && item.categoryId === category.id ? 'selected' : '' %>>
                <%= category.name %>
              </option>
            <% }) %>
          </select>
          <p class="text-xs text-slate-500">หมวดเมนูที่จะจัดกลุ่มเมนูย่อนี้</p>
        </div>
      </div>

      <div class="space-y-2">
        <label for="description" class="block text-sm font-semibold text-slate-700">
          คำอธิบาย
        </label>
        <textarea
          id="description"
          name="description"
          rows="3"
          class="w-full rounded-xl border border-slate-200 px-4 py-3 text-sm focus:border-primary-400 focus:outline-none focus:ring-2 focus:ring-primary-200"
          placeholder="คำอธิบายเพิ่มเติมเกี่ยวกับเมนูย่อนี้"
        ><%= item ? item.description : '' %></textarea>
        <p class="text-xs text-slate-500">คำอธิบายที่แสดงใต้ชื่อเมนูย่อ</p>
      </div>

      <div class="space-y-2">
        <label for="link" class="block text-sm font-semibold text-slate-700">
          ลิงก์
        </label>
        <input
          type="url"
          id="link"
          name="link"
          value="<%= item ? item.link : '' %>"
          class="w-full rounded-xl border border-slate-200 px-4 py-3 text-sm focus:border-primary-400 focus:outline-none focus:ring-2 focus:ring-primary-200"
          placeholder="https://example.com หรือ /internal-page"
        />
        <p class="text-xs text-slate-500">ลิงก์ที่ผู้ใช้จะไปเมื่อคลิกเมนูย่อ (เว้นว่างได้)</p>
      </div>

      <div class="grid gap-6 md:grid-cols-2">
        <div class="space-y-2">
          <label for="display_order" class="block text-sm font-semibold text-slate-700">
            ลำดับการแสดงผล
          </label>
          <input
            type="number"
            id="display_order"
            name="display_order"
            value="<%= item ? item.displayOrder : 0 %>"
            class="w-full rounded-xl border border-slate-200 px-4 py-3 text-sm focus:border-primary-400 focus:outline-none focus:ring-2 focus:ring-primary-200"
            placeholder="0"
            min="0"
          />
          <p class="text-xs text-slate-500">ตัวเลขน้อยจะแสดงก่อน</p>
        </div>

        <div class="space-y-2">
          <label for="image" class="block text-sm font-semibold text-slate-700">
            รูปภาพ
          </label>
          <input
            type="file"
            id="image"
            name="image"
            accept="image/*"
            class="w-full rounded-xl border border-slate-200 px-4 py-3 text-sm focus:border-primary-400 focus:outline-none focus:ring-2 focus:ring-primary-200"
          />
          <p class="text-xs text-slate-500">รูปภาพสำหรับเมนูย่อ (ขนาดแนะนำ: 40x40px)</p>
        </div>
      </div>

      <% if (item && item.imagePath) { %>
        <div class="space-y-2">
          <label class="block text-sm font-semibold text-slate-700">รูปภาพปัจจุบัน</label>
          <div class="flex items-center gap-4 rounded-xl border border-slate-200 bg-slate-50 p-4">
            <img
              src="/<%= item.imagePath %>"
              alt="<%= item.title %>"
              class="h-16 w-16 rounded-lg object-cover"
            />
            <div class="flex-1">
              <p class="text-sm font-medium text-slate-700">รูปภาพปัจจุบัน</p>
              <p class="text-xs text-slate-500">อัปโหลดรูปใหม่เพื่อเปลี่ยนรูปภาพ</p>
            </div>
            <div class="flex items-center gap-2">
              <input
                type="checkbox"
                id="removeImage"
                name="removeImage"
                value="true"
                class="h-4 w-4 rounded border-slate-300 text-red-600 focus:ring-red-200"
              />
              <label for="removeImage" class="text-sm font-medium text-red-600">
                ลบรูปภาพ
              </label>
            </div>
          </div>
        </div>
      <% } %>

      <div class="flex items-center gap-3">
        <input
          type="checkbox"
          id="is_active"
          name="is_active"
          value="1"
          <%= item && item.isActive ? 'checked' : '' %>
          class="h-4 w-4 rounded border-slate-300 text-primary-600 focus:ring-primary-200"
        />
        <label for="is_active" class="text-sm font-semibold text-slate-700">
          เปิดใช้งานเมนูย่อนี้
        </label>
      </div>

      <div class="flex flex-wrap items-center gap-3 pt-4 border-t border-slate-100">
        <button
          type="submit"
          class="inline-flex items-center gap-2 rounded-full bg-primary-600 px-6 py-3 text-sm font-semibold text-white shadow-sm transition hover:-translate-y-0.5 hover:bg-primary-700"
        >
          <svg class="h-4 w-4 text-white/90" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" />
          </svg>
          <%= mode === 'create' ? 'เพิ่มเมนูย่อ' : 'บันทึกการแก้ไข' %>
        </button>
        <a
          href="/admin/menu-items"
          class="inline-flex items-center gap-2 rounded-full border border-slate-200 px-6 py-3 text-sm font-semibold text-slate-600 transition hover:bg-slate-50"
        >
          <svg class="h-4 w-4 text-slate-500" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
          </svg>
          ยกเลิก
        </a>
      </div>
    </form>
  </section>
</main>

<%- include('partials/footer') %>
