<%- include('partials/head', { title }) %>
<%- include('partials/navbar') %>

<main class="mx-auto flex w-full max-w-6xl flex-1 flex-col gap-10 px-4 py-12 sm:px-6 lg:px-8">
  <header class="flex flex-col gap-4 sm:flex-row sm:items-end sm:justify-between">
    <div>
      <h1 class="text-3xl font-semibold text-primary-700">จัดการข่าวประชาสัมพันธ์</h1>
      <p class="mt-1 text-sm text-slate-600">สร้างเนื้อหา จัดการรูปภาพ และเผยแพร่ข่าวได้อย่างเป็นระบบ</p>
    </div>
    <a
      href="/admin/news/new"
      class="inline-flex items-center justify-center gap-2 rounded-xl bg-primary-600 px-5 py-2.5 text-sm font-medium text-white shadow-sm transition hover:-translate-y-0.5 hover:bg-primary-700"
    >
      <svg class="h-4 w-4 text-white/90" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
      </svg>
      สร้างข่าวใหม่
    </a>
  </header>

  <%- include('partials/flash') %>

  <% const publishedCount = articles ? articles.filter((item) => item.isPublished).length : 0; %>
  <% const draftCount = articles ? articles.length - publishedCount : 0; %>
  <% const attachmentTotal = articles ? articles.reduce((sum, item) => sum + (item.attachmentCount || 0), 0) : 0; %>

  <section class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
    <div class="rounded-2xl border border-primary-100 bg-white/80 p-5 shadow-sm backdrop-blur-sm">
      <p class="text-xs font-medium uppercase tracking-wide text-primary-500">ข่าวที่เผยแพร่</p>
      <div class="mt-2 flex items-end justify-between">
        <span class="text-3xl font-semibold text-primary-700"><%= publishedCount %></span>
        <span class="rounded-full bg-primary-50 px-3 py-1 text-xs font-semibold text-primary-600">
          ทั้งหมด <%= articles ? articles.length : 0 %> รายการ
        </span>
      </div>
    </div>
    <div class="rounded-2xl border border-amber-100 bg-white/80 p-5 shadow-sm backdrop-blur-sm">
      <p class="text-xs font-medium uppercase tracking-wide text-amber-500">ฉบับร่าง</p>
      <div class="mt-2 flex items-end justify-between">
        <span class="text-3xl font-semibold text-amber-600"><%= draftCount %></span>
        <span class="rounded-full bg-amber-50 px-3 py-1 text-xs font-semibold text-amber-600">
          พร้อมปรับปรุงและเผยแพร่
        </span>
      </div>
    </div>
    <div class="rounded-2xl border border-slate-200 bg-white/80 p-5 shadow-sm backdrop-blur-sm sm:col-span-2 lg:col-span-1">
      <p class="text-xs font-medium uppercase tracking-wide text-slate-500">ไฟล์แนบทั้งหมด</p>
      <div class="mt-2 flex items-end justify-between">
        <span class="text-3xl font-semibold text-slate-700"><%= attachmentTotal %></span>
        <span class="rounded-full bg-slate-100 px-3 py-1 text-xs font-semibold text-slate-600">
          สูงสุด 50 MB ต่อไฟล์
        </span>
      </div>
    </div>
  </section>

  <section class="rounded-3xl bg-white/90 shadow-sm ring-1 ring-black/5 backdrop-blur">
    <% if (articles && articles.length) { %>
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-slate-200 text-sm">
          <thead class="bg-slate-50 text-xs uppercase tracking-wide text-slate-500">
            <tr>
              <th scope="col" class="px-4 py-3 text-left">หัวข้อ</th>
              <th scope="col" class="px-4 py-3 text-left">สถานะ</th>
              <th scope="col" class="px-4 py-3 text-left">ไฟล์แนบ</th>
              <th scope="col" class="px-4 py-3 text-left">สร้างเมื่อ</th>
              <th scope="col" class="px-4 py-3 text-left">ปรับปรุงล่าสุด</th>
              <th scope="col" class="px-4 py-3 text-center">การจัดการ</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-slate-100">
            <% articles.forEach((item) => { %>
              <tr class="hover:bg-slate-50/70">
                <td class="px-4 py-3 font-medium text-slate-700">
                  <a href="/news/<%= item.slug %>" target="_blank" rel="noopener" class="hover:text-primary-600">
                    <%= item.title %>
                  </a>
                </td>
                <td class="px-4 py-3">
                  <% if (item.isPublished) { %>
                    <span class="inline-flex items-center gap-1 rounded-full bg-emerald-100 px-2.5 py-1 text-xs font-semibold text-emerald-700">
                      <span class="h-2 w-2 rounded-full bg-emerald-500"></span>
                      เผยแพร่แล้ว
                    </span>
                  <% } else { %>
                    <span class="inline-flex items-center gap-1 rounded-full bg-slate-200 px-2.5 py-1 text-xs font-semibold text-slate-600">
                      <span class="h-2 w-2 rounded-full bg-slate-500"></span>
                      ฉบับร่าง
                    </span>
                  <% } %>
                </td>
                <td class="px-4 py-3 text-slate-500">
                  <% if (item.attachmentCount > 0) { %>
                    <span class="inline-flex items-center gap-1 rounded-full bg-primary-50 px-3 py-1 text-xs font-semibold text-primary-600">
                      <svg class="h-3 w-3" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15.172 7l-6.586 6.586a2 2 0 1 0 2.828 2.828l6.415-6.414a4 4 0 0 0-5.657-5.657l-6.414 6.414" />
                      </svg>
                      <%= item.attachmentCount %> ไฟล์
                    </span>
                  <% } else { %>
                    <span class="text-xs text-slate-400">-</span>
                  <% } %>
                </td>
                <td class="px-4 py-3 text-slate-500">
                  <%= new Date(item.createdAt).toLocaleString('th-TH', { day: 'numeric', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit' }) %>
                </td>
                <td class="px-4 py-3 text-slate-500">
                  <%= new Date(item.updatedAt).toLocaleString('th-TH', { day: 'numeric', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit' }) %>
                </td>
                <td class="px-4 py-3">
                  <div class="flex items-center justify-center gap-2">
                    <a
                      href="/admin/news/<%= item.id %>/edit"
                      class="inline-flex items-center gap-1 rounded-md border border-primary-200 px-3 py-1 text-xs font-medium text-primary-600 transition hover:bg-primary-50"
                    >
                      <svg class="h-3.5 w-3.5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232a2.5 2.5 0 1 1 3.536 3.536L8.5 19.036 4 20l.964-4.5 10.268-10.268Z" />
                      </svg>
                      แก้ไข
                    </a>
                    <form action="/admin/news/<%= item.id %>/delete" method="post">
                      <button
                        type="submit"
                        data-confirm-message="ยืนยันการลบข่าวนี้หรือไม่?"
                        class="inline-flex items-center gap-1 rounded-md bg-rose-500 px-3 py-1 text-xs font-medium text-white transition hover:bg-rose-600"
                      >
                        <svg class="h-3.5 w-3.5 text-white/80" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6m0 12L6 6" />
                        </svg>
                        ลบ
                      </button>
                    </form>
                  </div>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    <% } else { %>
      <div class="px-8 py-16 text-center text-slate-500">
        ยังไม่มีข่าวประชาสัมพันธ์ในระบบ เริ่มต้นด้วยการสร้างข่าวใหม่
      </div>
    <% } %>
  </section>
</main>

<%- include('partials/footer') %>
