<%- include('partials/head', { title }) %>
<%- include('partials/navbar') %>

<main class="mx-auto flex w-full max-w-6xl flex-1 flex-col gap-10 px-4 py-12 sm:px-6 lg:px-8">
  <%
    const settings = siteSettings || {};
    const currentSiteName = settings.siteName || (site && site.siteName) || 'ระบบจัดการสมาชิก';
    const currentStatus = settings.siteStatus || (site && site.siteStatus) || 'open';
    const currentLogoUrl = settings.siteLogoUrl || (site && site.siteLogoUrl) || null;
    const isClosed = currentStatus === 'closed';
  %>

  <header class="flex flex-col gap-6 rounded-3xl border border-primary-100 bg-white/80 p-6 shadow-sm backdrop-blur sm:flex-row sm:items-center sm:justify-between">
    <div class="space-y-2">
      <p class="text-xs font-semibold uppercase tracking-wider text-primary-500">ตั้งค่าระบบ</p>
      <h1 class="text-3xl font-semibold text-primary-700">จัดการภาพลักษณ์เว็บไซต์</h1>
      <p class="max-w-xl text-sm leading-relaxed text-slate-600">
        ปรับชื่อเว็บไซต์ โลโก้หลัก และสถานะการเปิดให้ใช้งาน รวมถึงตรวจสอบภาพโปรไฟล์ของสมาชิกทั้งหมดได้จากหน้าจอนี้
      </p>
    </div>
    <div class="flex items-center gap-3">
      <span class="inline-flex items-center gap-2 rounded-full border border-slate-200 bg-white px-3 py-1.5 text-xs font-semibold text-slate-600">
        <span class="h-2.5 w-2.5 rounded-full <%= isClosed ? 'bg-rose-500' : 'bg-emerald-500' %>"></span>
        <%= isClosed ? 'สถานะเว็บไซต์: ปิดปรับปรุง' : 'สถานะเว็บไซต์: เปิดใช้งาน' %>
      </span>
      <a
        href="<%= isClosed ? '/admin/dashboard' : '/home' %>"
        class="inline-flex items-center gap-2 rounded-full border border-primary-200/70 bg-white px-4 py-2 text-xs font-semibold text-primary-600 transition hover:bg-primary-50"
      >
        <svg class="h-4 w-4" fill="none" stroke="currentColor" stroke-width="1.6" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="m9 7-5 5m0 0 5 5m-5-5h16" />
        </svg>
        กลับไปหน้าแดชบอร์ด
      </a>
    </div>
  </header>

  <%- include('partials/flash') %>

  <section class="grid gap-6 lg:grid-cols-[1.35fr_1fr]">
    <form action="/admin/settings" method="post" enctype="multipart/form-data" class="space-y-6 rounded-3xl border border-slate-200 bg-white/95 p-6 shadow-sm ring-1 ring-black/5">
      <div class="flex items-center justify-between">
        <div>
          <h2 class="text-lg font-semibold text-slate-800">ข้อมูลเว็บไซต์</h2>
          <p class="text-xs text-slate-500">อัปเดตชื่อเว็บไซต์ สถานะ และโลโก้หลัก</p>
        </div>
        <% if (currentLogoUrl) { %>
          <span class="inline-flex items-center gap-2 rounded-full bg-primary-50 px-3 py-1 text-xs font-semibold text-primary-600">
            <svg class="h-4 w-4" fill="none" stroke="currentColor" stroke-width="1.6" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 6.75 12 3l7.5 3.75v7.5L12 21l-7.5-3.75v-7.5Z" />
            </svg>
            แสดงโลโก้อยู่
          </span>
        <% } %>
      </div>

      <div class="space-y-2">
        <label for="site-name" class="text-sm font-semibold text-slate-700">ชื่อเว็บไซต์</label>
        <input
          type="text"
          id="site-name"
          name="site_name"
          value="<%= currentSiteName %>"
          required
          maxlength="120"
          class="w-full rounded-2xl border border-slate-200 px-4 py-3 text-sm text-slate-700 shadow-sm focus:border-primary-400 focus:outline-none focus:ring-2 focus:ring-primary-200"
          placeholder="เช่น ศูนย์ข้อมูลสมาชิก"
        />
      </div>

      <div class="space-y-3">
        <span class="text-sm font-semibold text-slate-700">สถานะเว็บไซต์</span>
        <div class="grid gap-2 sm:grid-cols-2">
          <label class="flex items-center gap-3 rounded-2xl border border-slate-200 bg-white px-4 py-3 text-sm font-medium text-slate-600 shadow-sm transition hover:border-primary-200 hover:text-primary-600">
            <input
              type="radio"
              name="site_status"
              value="open"
              class="h-4 w-4 border-slate-300 text-primary-600 focus:ring-primary-500"
              <%= isClosed ? '' : 'checked' %>
            />
            เปิดให้เข้าชมเว็บไซต์
          </label>
          <label class="flex items-center gap-3 rounded-2xl border border-slate-200 bg-white px-4 py-3 text-sm font-medium text-slate-600 shadow-sm transition hover:border-rose-200 hover:text-rose-600">
            <input
              type="radio"
              name="site_status"
              value="closed"
              class="h-4 w-4 border-slate-300 text-rose-600 focus:ring-rose-500"
              <%= isClosed ? 'checked' : '' %>
            />
            ปิดปรับปรุง (เฉพาะผู้ดูแลเข้าถึงได้)
          </label>
        </div>
      </div>

      <div class="space-y-3">
        <div class="flex items-center justify-between">
          <span class="text-sm font-semibold text-slate-700">โลโก้เว็บไซต์</span>
          <% if (currentLogoUrl) { %>
            <label class="inline-flex cursor-pointer items-center gap-2 rounded-full border border-slate-200 bg-white px-3 py-1.5 text-[11px] font-semibold text-slate-500 hover:border-rose-200 hover:text-rose-600">
              <input type="checkbox" name="remove_logo" value="true" class="h-3.5 w-3.5 border-slate-300 text-rose-600 focus:ring-rose-500" />
              ลบโลโก้ปัจจุบัน
            </label>
          <% } %>
        </div>
        <div class="grid gap-3 sm:grid-cols-[150px_auto] sm:items-start">
          <div class="relative flex h-36 w-full items-center justify-center overflow-hidden rounded-2xl border border-dashed border-slate-200 bg-slate-50/60">
            <% if (currentLogoUrl) { %>
              <img src="<%= currentLogoUrl %>" alt="โลโก้เว็บไซต์" class="h-full w-full object-contain p-3" />
            <% } else { %>
              <span class="text-xs font-medium text-slate-400">ยังไม่มีโลโก้</span>
            <% } %>
          </div>
          <div class="space-y-3 rounded-2xl border border-slate-200 bg-white px-4 py-4 shadow-sm">
            <p class="text-xs text-slate-500">
              อัปโหลดไฟล์ภาพชนิด PNG หรือ JPG ขนาดไม่เกิน 2 MB เพื่อใช้เป็นโลโก้หลักของเว็บไซต์
            </p>
            <label class="inline-flex items-center justify-center gap-2 rounded-2xl bg-primary-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:-translate-y-0.5 hover:bg-primary-700">
              <svg class="h-4 w-4 text-white/90" fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 5v14m7-7H5" />
              </svg>
              เลือกไฟล์โลโก้
              <input type="file" name="site_logo" accept="image/png,image/jpeg,image/webp" class="hidden" />
            </label>
          </div>
        </div>
      </div>

      <div class="flex flex-wrap items-center justify-between gap-3">
        <p class="text-xs text-slate-500">
          บันทึกการเปลี่ยนแปลงจะมีผลทันที และผู้ดูแลระบบทุกคนจะเห็นค่าที่อัปเดตร่วมกัน
        </p>
        <button
          type="submit"
          class="inline-flex items-center gap-2 rounded-full bg-primary-600 px-5 py-2.5 text-sm font-semibold text-white shadow-sm transition hover:-translate-y-0.5 hover:bg-primary-700"
        >
          <svg class="h-4 w-4 text-white/90" fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M5 13a4 4 0 0 1 4-4h9m0 0-3-3m3 3-3 3" />
          </svg>
          บันทึกการตั้งค่า
        </button>
      </div>
    </form>

    <section class="space-y-4 rounded-3xl border border-slate-200 bg-white/95 p-6 shadow-sm ring-1 ring-black/5">
      <div class="flex items-center justify-between">
        <div>
          <h2 class="text-lg font-semibold text-slate-800">ภาพโปรไฟล์ทั้งหมด</h2>
          <p class="text-xs text-slate-500">ตัวอย่างภาพที่สมาชิกใช้งานล่าสุด</p>
        </div>
        <span class="rounded-full bg-slate-100 px-3 py-1 text-xs font-semibold text-slate-500">
          <%= Array.isArray(profileImages) ? profileImages.length : 0 %> ภาพ
        </span>
      </div>
      <% if (profileImages && profileImages.length) { %>
        <div class="grid grid-cols-3 gap-3 sm:grid-cols-4">
          <% profileImages.forEach((profile) => { %>
            <figure class="group relative overflow-hidden rounded-2xl border border-slate-100 bg-slate-50 shadow-sm">
              <img
                src="<%= profile.imageUrl %>"
                alt="<%= profile.name %>"
                class="h-24 w-full object-cover transition duration-200 group-hover:scale-105"
              />
              <figcaption class="absolute inset-x-0 bottom-0 bg-gradient-to-t from-slate-900/80 via-slate-900/20 to-transparent px-2 py-1 text-[10px] font-medium text-white">
                <span class="block truncate"><%= profile.name %></span>
              </figcaption>
            </figure>
          <% }) %>
        </div>
      <% } else { %>
        <div class="flex min-h-[10rem] flex-col items-center justify-center gap-2 rounded-2xl border border-dashed border-slate-200 bg-slate-50/70 text-center text-sm text-slate-500">
          <svg class="h-8 w-8 text-slate-300" fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 7.5a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 20.25a8.25 8.25 0 0 1 15 0" />
          </svg>
          ยังไม่มีสมาชิกที่อัปโหลดโปรไฟล์
        </div>
      <% } %>
    </section>
  </section>
</main>

<%- include('partials/footer') %>
